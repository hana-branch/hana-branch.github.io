<!DOCTYPE html lang="en">
<html>
  <head>
    <title>Branch Metrics Web SDK Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="branch:deeplink:user.type" content="test" />
    <meta name="branch:deeplink:pageType" content="ListPage" />
    <meta name="branch:deeplink:productView" content="true" />
    <meta data-rh="true" id="meta-og-image" name="image" content="https://boxed-web2-assets-prod-gcp.boxed.com/public/images/boxed-logo-256x256.png">
    <!-- Smart Banner -->
    <!-- <meta name="apple-itunes-app" content="app-id=917737838">  -->
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://hana-branch.github.io/apple-touch-icon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://hana-branch.github.io/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="https://hana-branch.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://hana-branch.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://hana-branch.github.io/site.webmanifest">

    <!-- Styles --> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Bebas+Neue|Roboto&display=swap" rel="stylesheet">

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5BC9FN9');</script>
    <!-- End Google Tag Manager -->

<!--     <script type="text/javascript">
      // load Branch
      (function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent disableTracking qrCode".split(" "), 0);

      // add Branch Listner
      // var listener = function(event, data) { console.info("BranchSDK Listner:", event, data); }
      // branch.addListener(listener);

      // disable Branch tracking
      // branch.disableTracking(true)

      const loadBranchAndGetFingerprint = new Promise(function(resolve, reject) {
        // init Branch
        branch.init('key_live_fdGefNezUn2f4SqsEYE6sljpDwmRPOl2', {}, function(err, data) {
          if (!!err) {
            console.error('BranchSDK Error: ', err);
            return reject(err)
          };

          console.info('BranchSDK initialize Success')
          console.log('BranchSDK Data: ', data);

          document.querySelector("pre#init-response").innerHTML = JSON.stringify(data);

          // close Branch Journey Banner
          setTimeout(function() {
           if (navigator.userAgent.toLowerCase().indexOf('safari/') > -1) {
              branch.closeJourney(function(err) {
                console.info('BranchSDK closeJourney is called');
                if(err) console.error('BranchSDK closeJourney Error:', err);
              });
            }
          }, 500);

          branch.getBrowserFingerprintId(function(err, fingerprint) {  // fetch the browser fingerprint from the SDK
            if (!!err) {
              console.error('BranchSDK getBrowserFingerprintId Error: ', err);
              reject(err);
              return;
            }
            resolve({...data, fingerprint});
          });
        });
      });

      var tiggerCustomEvent = function() {
        var custom_data = {
          "Custom_Event_Property_Key1": "Custom_Event_Property_val1",
          "Custom_Event_Property_Key2": "Custom_Event_Property_val2",
          "array": ["1", "2", "3", "4"],
          "number": "[\"479294391\",\"2078332144\",\"1135773900\",\"1667121068\",\"387781082\",\"697979600\",\"973877442\",\"1963324657\"]"
        };

        branch.logEvent(
          'custom_event_name',
          custom_data,
          function(err) { if(err) console.error('BranchSDK CustomEvent Error:', err); }
        );
      }

      var tiggerPurchaseEvent = function() {
        var event_and_custom_data = {
           "transaction_id": "tras_Id_1232343434",
           "currency": "USD",
           "revenue": 180.2,
           "shipping": 10.5,
           "tax": 13.5,
           "coupon": "promo-1234",
           "affiliation": "high_fi",
           "description": "Preferred purchase",
           "purchase_loc": "Palo Alto",
           "store_pickup": "unavailable"
        };

        branch.logEvent(
          'PURCHASE',
          event_and_custom_data,
          function(err) { if(err) console.error('BranchSDK PurchaseEvent Error:', err); }
        );
      }

      var data = function() {
        branch.data(function (err, data) {
          if(err) console.error('BranchSDK data Error:', err);

          console.log('BranchSDK Data: ', data);
          document.querySelector("pre#response").innerHTML = JSON.stringify(data);
        });
      }

      var latd = function() {
        document.querySelector("#latd").focus();
        branch.lastAttributedTouchData(
          function (err, data) {
            if(err) console.error('BranchSDK lastAttributedTouchData Error:', err);

            console.log('BranchSDK lastAttributedTouchData Data: ', data);
            document.querySelector("pre#response").innerHTML = JSON.stringify(data);
          }
        );
      }

      var createLink = function() {
        var linkData = {
          campaign: 'content 123',
          channel: 'facebook',
          feature: 'dashboard',
          stage: 'new user',
          tags: [ 'tag1', 'tag2', 'tag3' ],
          data: {
            'custom_bool': true,
            'custom_int': Date.now(),
            'custom_string': 'hello',
            'custom_obj': {"hello": "hi", "number": null},
            '$og_title': 'Title',
            '$og_description': 'Description',
            '$og_image_url':'http://lorempixel.com/400/400',
            '$fallback_url': 'https://hana-branch.github.io/'
          }
        };

        branch.link(linkData, function(err, link) {
          if(err) console.error('BranchSDK createLink Error:', err);
          console.log('BranchSDK Created Link: ', link);
          document.querySelector("pre#response").innerHTML = '<a href="' + link + '">' + link + '</a>'
        });
      }

      // Segment 
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="F0EqctxfRnGze9dIDc7DilKjeOPSaXVV";;analytics.SNIPPET_VERSION="4.15.3";
        analytics.load("F0EqctxfRnGze9dIDc7DilKjeOPSaXVV");
        analytics.page();
        loadBranchAndGetFingerprint.then(function(data) {
          const { fingerprint } = data;
          console.log("fingerprint :", fingerprint);
          // Load the Segment SDK and initialize with key here

          // Segment track request
          analytics.track('Branch Segment Article Completed Track Test', {
              browser_fingerprint_id: fingerprint // add the browser fingerprint to the Segment track event
              //... Other event details ...
          });
        });
      }}();
    </script> -->
    <style type="text/css">
      body {
        background-color: #fcfcfc;
        text-align: center;
        margin: auto;
      }
      .ui.button {
        display: inline-block;
        margin: 7px;
      }
      .ui.menu .item img.logo {
        margin-right: 1.5em;
      }
      .main.container {
        margin-top: 7em;
      }
      .ui.image {
        margin: auto;
      }
      pre {
        word-break: break-word;
        overflow-wrap: break-word;
        white-space: pre-line;
      }
    </style>
  </head>
  <body data-new-gr-c-s-check-loaded="14.1063.0" data-gr-ext-installed="">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5BC9FN9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="ui main text container">
      <div class="ui fixed inverted menu">
        <div class="branch-journeys-top"></div>
        <div class="ui container">
          <a href="#" class="header item">
            <img class="logo" src="./favicon-32x32.png">
            Hana Web Test
          </a>
          <a href="#" class="item">Home</a>
        </div>
      </div>
    </div>
    <div class="ui main text container">
        <h1 class="ui header">Hana Web Test</h1>  
        <div class="image">
          <img class="ui medium rounded image" src="https://is3-ssl.mzstatic.com/image/thumb/Purple114/v4/6b/fe/0e/6bfe0ecc-497e-4552-648f-f085badb71f8/AppIcon-0-0-1x_U007emarketing-0-0-0-10-85-220.png/246x0w.png">
        </div>

        <section class="ui segment init-response">
          <h4>Init Response</h4>
          <div class="ui placeholder segment">
            <pre id="init-response"></pre>
          <div>
        </section>
        <section class="ui segment response">
          <h4>Response</h4>
          <pre id="response">Click a button!</pre>
        </section>
        <div class="ui divider"></div>
        <section class="methods">
          <button class="ui basic button" onclick="tiggerCustomEvent()">Create Custom Event</button>
          <button class="ui basic button" onclick="tiggerPurchaseEvent()">Create Purchase Event</button>
          <button class="ui basic button" onclick="createLink()">Create Link</button>
          <button class="ui basic button" onclick="data()">data</button>
          <button class="ui basic button" id="latd" onclick="latd()" tabindex="0">LATD</button>
        </section>
        <div class="ui divider"></div>
    </div>
  </body>
</html>
